---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const slugify = (tag) =>
	tag
		.trim()
		.toLowerCase()
		.replace(/[^a-z0-9]+/g, "-")
		.replace(/^-+|-+$/g, "");

const allPosts = await getCollection("blog");
const posts = allPosts.filter((post) => post.data.lang === "es");

const tagMap = new Map();
for (const post of posts) {
	for (const tag of post.data.tags ?? []) {
		const slug = slugify(tag);
		if (!slug) continue;
		const entry = tagMap.get(slug) ?? { label: tag, count: 0 };
		tagMap.set(slug, { label: entry.label, count: entry.count + 1 });
	}
}

const tags = Array.from(tagMap.entries())
	.map(([slug, info]) => ({ slug, ...info }))
	.sort((a, b) => a.label.localeCompare(b.label));
---

<BaseLayout
	title="Etiquetas — Swifty Journey"
	description="Explora artículos por tema"
	lang="es"
>
	<div class="py-12">
		<div class="mb-10">
			<h1 class="text-3xl md:text-4xl font-bold text-zinc-900 dark:text-zinc-100 mb-3">
				Etiquetas
			</h1>
			<p class="text-zinc-600 dark:text-zinc-400">
				Explora artículos por tema
			</p>
		</div>

		{tags.length === 0 ? (
			<p class="text-zinc-600 dark:text-zinc-400">Aún no hay etiquetas.</p>
		) : (
			<div class="flex flex-wrap gap-3">
				{tags.map((tag) => (
					<a
						href={`/es/tags/${tag.slug}/`}
						class="inline-flex items-center gap-2 px-4 py-2 rounded-full border border-zinc-200 dark:border-zinc-800 text-sm text-zinc-700 dark:text-zinc-300 hover:text-orange-500 hover:border-orange-300 dark:hover:text-orange-300 transition-colors"
					>
						<span>{tag.label}</span>
						<span class="text-xs text-zinc-500 dark:text-zinc-400">
							{tag.count}
						</span>
					</a>
				))}
			</div>
		)}
	</div>
</BaseLayout>
